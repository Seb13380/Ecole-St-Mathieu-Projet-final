{% extends "layouts/main.twig" %}

{% block content %}
	<div class="min-h-screen bg-gradient-to-br from-[#a7e3dd] to-[#8dd3cc] py-12">
		<div class="container mx-auto px-4">
			<div
				class="max-w-4xl mx-auto">
				<!-- En-t√™te -->
				<div class="text-center mb-8">
					<h1 class="text-4xl font-bold text-[#304a4d] mb-4">
						üìù Pr√©-inscription √âl√®ve
					</h1>
					<p class="text-lg text-[#304a4d]/80">
						Demande d'inscription pour l'ann√©e scolaire 2025-2026
					</p>
				</div>

				<!-- Messages flash -->
				{% if success %}
					<div class="alert alert-success mb-6">
						<span>‚úÖ
							{{ success }}</span>
					</div>
				{% endif %}

				{% if error %}
					<div class="alert alert-error mb-6">
						<span>‚ùå
							{{ error }}</span>
					</div>
				{% endif %}

				<!-- Formulaire -->
				<div class="bg-white rounded-xl shadow-lg p-8">
					<form
						action="/pre-inscription" method="POST" class="space-y-6">

						<!-- Section Parent/Responsable -->
						<div class="border-b border-gray-200 pb-6">
							<h2 class="text-2xl font-semibold text-[#304a4d] mb-4">
								üë§ Informations du Parent/Responsable
							</h2>

							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Pr√©nom *</span>
									</label>
									<input type="text" name="parentFirstName" class="input input-bordered w-full" required>
								</div>
								<input class="floflo" type="text" name="status" value="PENDING">

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Nom *</span>
									</label>
									<input type="text" name="parentLastName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Email *</span>
									</label>
									<input type="email" name="parentEmail" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">T√©l√©phone *</span>
									</label>
									<input type="tel" name="parentPhone" class="input input-bordered w-full" required>
								</div>
							</div>

							<!-- Section Mot de passe -->
							<div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mt-4">
								<h3 class="text-lg font-semibold text-orange-800 mb-3">
									üîí Mot de passe pour votre compte
								</h3>
								<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
									<div class="form-control">
										<label class="label">
											<span class="label-text font-medium">Mot de passe *</span>
										</label>
										<input type="password" name="parentPassword" class="input input-bordered w-full" 
											   placeholder="Minimum 6 caract√®res" minlength="6" required>
										<label class="label">
											<span class="label-text-alt text-gray-500">Au moins 6 caract√®res avec majuscule, minuscule et chiffre</span>
										</label>
									</div>

									<div class="form-control">
										<label class="label">
											<span class="label-text font-medium">Confirmer le mot de passe *</span>
										</label>
										<input type="password" name="confirmPassword" class="input input-bordered w-full" 
											   placeholder="Ressaisissez le mot de passe" minlength="6" required>
									</div>
								</div>
							</div>

							<div class="form-control mt-4">
								<label class="label">
									<span class="label-text font-medium">Adresse compl√®te</span>
								</label>
								<textarea name="parentAddress" class="textarea textarea-bordered w-full" rows="3" placeholder="Adresse, code postal, ville"></textarea>
							</div>
						</div>

						<!-- Section √âl√®ve -->
						<div class="border-b border-gray-200 pb-6">
							<h2 class="text-2xl font-semibold text-[#304a4d] mb-4">
								üéì Informations de l'√âl√®ve
							</h2>

							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Pr√©nom de l'√©l√®ve *</span>
									</label>
									<input type="text" name="studentFirstName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Nom de l'√©l√®ve *</span>
									</label>
									<input type="text" name="studentLastName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Date de naissance *</span>
									</label>
									<input type="date" name="studentBirthDate" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Classe actuelle</span>
									</label>
									<select name="currentClass" class="select select-bordered w-full">
										<option value="">S√©lectionner...</option>
										<option value="TPS">TPS (Toute Petite Section)</option>
										<option value="PS">PS (Petite Section)</option>
										<option value="MS">MS (Moyenne Section)</option>
										<option value="GS">GS (Grande Section)</option>
										<option value="CP">CP</option>
										<option value="CE1">CE1</option>
										<option value="CE2">CE2</option>
										<option value="CM1">CM1</option>
										<option value="CM2">CM2</option>
										<option value="Autre">Autre √©cole/niveau</option>
									</select>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Classe demand√©e *</span>
									</label>
									<select name="requestedClass" class="select select-bordered w-full" required>
										<option value="">S√©lectionner...</option>
										<option value="TPS">TPS (Toute Petite Section)</option>
										<option value="PS">PS (Petite Section)</option>
										<option value="MS">MS (Moyenne Section)</option>
										<option value="GS">GS (Grande Section)</option>
										<option value="CP">CP</option>
										<option value="CE1">CE1</option>
										<option value="CE2">CE2</option>
										<option value="CM1">CM1</option>
										<option value="CM2">CM2</option>
									</select>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">√âcole pr√©c√©dente</span>
									</label>
									<input type="text" name="previousSchool" class="input input-bordered w-full" placeholder="Nom de l'√©tablissement pr√©c√©dent">
								</div>
							</div>
						</div>

						<!-- Section Besoins sp√©ciaux et message -->
						<div class="space-y-4">
							<div class="form-control">
								<label class="label">
									<span class="label-text font-medium">Besoins particuliers ou am√©nagements</span>
								</label>
								<textarea name="specialNeeds" class="textarea textarea-bordered w-full" rows="3" placeholder="PAI, PPRE, troubles, allergies, etc."></textarea>
							</div>

							<div class="form-control">
								<label class="label">
									<span class="label-text font-medium">Message libre</span>
								</label>
								<textarea name="message" class="textarea textarea-bordered w-full" rows="4" placeholder="Motivations, questions, informations compl√©mentaires..."></textarea>
							</div>
						</div>

						<!-- Information importante -->
						<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
							<h3 class="font-semibold text-blue-800 mb-2">üìã √Ä noter :</h3>
							<ul class="text-blue-700 text-sm space-y-1">
								<li>‚Ä¢ Cette demande ne constitue pas une inscription d√©finitive</li>
								<li>‚Ä¢ Nous vous recontacterons pour un entretien avec la direction</li>
								<li>‚Ä¢ L'inscription sera finalis√©e apr√®s acceptation et constitution du dossier</li>
								<li>‚Ä¢ Les places sont limit√©es selon les niveaux</li>
							</ul>
						</div>

						<!-- Boutons -->
						<div class="flex flex-col sm:flex-row gap-4 pt-6">
							<button type="submit" class="btn btn-primary flex-1">
								üì§ Envoyer la demande
							</button>
							<a href="/" class="btn btn-ghost flex-1">
								‚Ü©Ô∏è Retour √† l'accueil
							</a>
						</div>
					</form>
				</div>

				<!-- Informations de contact -->
				<div class="bg-white rounded-xl shadow-lg p-6 mt-8">
					<h3 class="text-xl font-semibold text-[#304a4d] mb-4">
						üìû Besoin d'aide ?
					</h3>
					<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
						<div>
							<p class="font-medium">Secr√©tariat :</p>
							<p>üìß secretariat@stmathieu.org</p>
							<p>‚òéÔ∏è 04 XX XX XX XX</p>
						</div>
						<div>
							<p class="font-medium">Horaires d'accueil :</p>
							<p>Lundi - Vendredi : 8h00 - 17h00</p>
							<p>Mercredi : 8h00 - 12h00</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Validation en temps r√©el des mots de passe
		document.addEventListener('DOMContentLoaded', function() {
			const passwordInput = document.querySelector('input[name="parentPassword"]');
			const confirmPasswordInput = document.querySelector('input[name="confirmPassword"]');
			const form = document.querySelector('form');

			function validatePassword() {
				const password = passwordInput.value;
				const confirmPassword = confirmPasswordInput.value;
				
				// Validation de la force du mot de passe
				const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
				
				if (password.length > 0) {
					if (!passwordRegex.test(password)) {
						passwordInput.classList.add('input-error');
					} else {
						passwordInput.classList.remove('input-error');
					}
				}

				// Validation de la correspondance
				if (confirmPassword.length > 0) {
					if (password !== confirmPassword) {
						confirmPasswordInput.classList.add('input-error');
					} else {
						confirmPasswordInput.classList.remove('input-error');
					}
				}
			}

			passwordInput.addEventListener('input', validatePassword);
			confirmPasswordInput.addEventListener('input', validatePassword);

			// Validation au moment de la soumission
			form.addEventListener('submit', function(e) {
				const password = passwordInput.value;
				const confirmPassword = confirmPasswordInput.value;
				const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;

				if (!passwordRegex.test(password)) {
					e.preventDefault();
					alert('Le mot de passe doit contenir au moins 6 caract√®res avec une majuscule, une minuscule et un chiffre.');
					return;
				}

				if (password !== confirmPassword) {
					e.preventDefault();
					alert('Les mots de passe ne correspondent pas.');
					return;
				}
			});
		});
	</script>
{% endblock %}
