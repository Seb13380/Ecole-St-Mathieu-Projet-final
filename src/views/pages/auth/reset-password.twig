{% extends "layouts/auth.twig" %}

{% block content %}
	<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-teal-50 py-12 px-4 sm:px-6 lg:px-8">
		<div class="max-w-md w-full space-y-8">
			<div>
				<div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100">
					<svg class="h-6 w-6 text-green-600" fill="none" viewbox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-6 6c-3 0-5.5-1-7.5-3S3 9 3 9a6 6 0 016-6c1 0 3.5.5 5.5 1.5S17 7 17 7zM9 13h6m-3-3v6"/>
					</svg>
				</div>
				<h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
					Nouveau mot de passe
				</h2>
				<p class="mt-2 text-center text-sm text-gray-600">
					Choisissez un mot de passe sécurisé pour votre compte.
				</p>
			</div>

			{% if error %}
				<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
					<div class="flex items-center">
						<svg class="w-4 h-4 mr-2" fill="currentColor" viewbox="0 0 20 20">
							<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
						</svg>
						<span>
							{% if error == 'password_too_short' %}
								Le mot de passe doit contenir au moins 6 caractères.
							{% elseif error == 'password_mismatch' %}
								Les mots de passe ne correspondent pas.
							{% elseif error == 'system_error' %}
								Une erreur système s'est produite. Réessayez plus tard.
							{% else %}
								Une erreur s'est produite. Veuillez réessayer.
							{% endif %}
						</span>
					</div>
				</div>
			{% endif %}

			<form class="mt-8 space-y-6" action="/auth/reset-password/{{ token }}" method="POST" id="resetForm">
				<div class="space-y-4">
					<div>
						<label for="password" class="block text-sm font-medium text-gray-700 mb-2">
							Nouveau mot de passe
						</label>
						<input id="password" name="password" type="password" required minlength="6" class="relative block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 focus:z-10 sm:text-sm" placeholder="Minimum 6 caractères">
						<div id="password-strength" class="mt-2 text-xs"></div>
					</div>

					<div>
						<label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
							Confirmer le mot de passe
						</label>
						<input id="confirmPassword" name="confirmPassword" type="password" required minlength="6" class="relative block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 focus:z-10 sm:text-sm" placeholder="Répétez le mot de passe">
						<div id="password-match" class="mt-2 text-xs"></div>
					</div>
				</div>

				<div>
					<button type="submit" id="submitBtn" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transform transition-all duration-200 hover:scale-105 hover:shadow-lg animate__animated animate__pulse">
						<span class="absolute left-0 inset-y-0 flex items-center pl-3">
							<svg class="h-5 w-5 text-teal-300 group-hover:text-teal-200" fill="none" viewbox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
							</svg>
						</span>
						Mettre à jour le mot de passe
					</button>
				</div>
			</form>

			<div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
				<div class="flex items-start">
					<svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewbox="0 0 20 20">
						<path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
					</svg>
					<div class="text-sm text-yellow-700">
						<strong>Conseil de sécurité :</strong>
						Utilisez un mot de passe unique avec des lettres, chiffres et symboles pour une sécurité optimale.
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
const passwordInput = document.getElementById('password');
const confirmPasswordInput = document.getElementById('confirmPassword');
const strengthDiv = document.getElementById('password-strength');
const matchDiv = document.getElementById('password-match');
const submitBtn = document.getElementById('submitBtn');

// Vérification de la force du mot de passe
passwordInput.addEventListener('input', function () {
const password = this.value;
let strength = 0;
let feedback = [];

if (password.length >= 6) 
strength++;
 else 
feedback.push('Au moins 6 caractères');


if (/[a-z]/.test(password)) 
strength++;
 else 
feedback.push('Une lettre minuscule');


if (/[A-Z]/.test(password)) 
strength++;
 else 
feedback.push('Une lettre majuscule');


if (/[0-9]/.test(password)) 
strength++;
 else 
feedback.push('Un chiffre');


if (/[^A-Za-z0-9]/.test(password)) 
strength++;
 else 
feedback.push('Un caractère spécial');


// Affichage de la force
if (password.length === 0) {
strengthDiv.innerHTML = '';
} else if (strength < 2) {
strengthDiv.innerHTML = '<span class="text-red-600">❌ Faible</span>';
} else if (strength < 4) {
strengthDiv.innerHTML = '<span class="text-yellow-600">⚠️ Moyen</span>';
} else {
strengthDiv.innerHTML = '<span class="text-green-600">✅ Fort</span>';
}

if (feedback.length > 0 && password.length > 0) {
strengthDiv.innerHTML += `<br><span class="text-gray-500">Manque: ${
feedback.join(', ')
}</span>`;
}

checkPasswordMatch();
});

// Vérification de la correspondance des mots de passe
confirmPasswordInput.addEventListener('input', checkPasswordMatch);

function checkPasswordMatch() {
const password = passwordInput.value;
const confirmPassword = confirmPasswordInput.value;

if (confirmPassword.length === 0) {
matchDiv.innerHTML = '';
return;
}

if (password === confirmPassword) {
matchDiv.innerHTML = '<span class="text-green-600">✅ Les mots de passe correspondent</span>';
} else {
matchDiv.innerHTML = '<span class="text-red-600">❌ Les mots de passe ne correspondent pas</span>';
}
}

// Validation du formulaire
document.getElementById('resetForm').addEventListener('submit', function (e) {
const password = passwordInput.value;
const confirmPassword = confirmPasswordInput.value;

if (password.length < 6) {
e.preventDefault();
alert('Le mot de passe doit contenir au moins 6 caractères.');
return;
}

if (password !== confirmPassword) {
e.preventDefault();
alert('Les mots de passe ne correspondent pas.');
return;
}

// Animation du bouton
submitBtn.innerHTML = '<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Mise à jour...';
submitBtn.disabled = true;
});
});
	</script>
{% endblock %}
