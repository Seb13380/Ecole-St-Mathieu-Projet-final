{% extends "../layouts/base.twig" %}

{% block main %}
	<div class="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 py-8">
		<div
			class="container mx-auto px-4">

			<!-- Header -->
			<div class="text-center mb-12">
				<h1 class="text-4xl font-bold text-gray-800 mb-4">Images et Vid√©os</h1>
				<p class="text-lg text-gray-600">D√©couvrez les moments forts de notre √©cole</p>

				{% if user and (user.role == 'ADMIN' or user.role == 'DIRECTION' or user.role == 'GESTIONNAIRE_SITE') %}
					<div class="mt-6">
						<a href="/gallery/admin" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
							üîß G√©rer la galerie
						</a>
					</div>
				{% endif %}
			</div>

			<!-- Galerie par th√®mes -->
			{% if themes|length > 0 %}
				{% for theme in themes %}
					{% if theme.medias|length > 0 %}
						<div class="mb-16">
							<div
								class="bg-white rounded-xl shadow-lg overflow-hidden">

								<!-- En-t√™te du th√®me -->
								<div class="p-8 shadow-2xl" style="background: linear-gradient(135deg, #2d5a56 0%, #4a7c79 50%, #a7e3dd 100%); border-left: 8px solid #1e3a39;">
									<h2 class="text-4xl font-black mb-4 text-white drop-shadow-2xl" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">{{ theme.name }}</h2>
									{% if theme.description %}
										<p class="text-white text-xl font-bold p-4 rounded-lg" style="background: rgba(30, 58, 57, 0.7); border: 2px solid #a7e3dd;">{{ theme.description }}</p>
									{% endif %}
									<div class="text-lg mt-4 font-black inline-block px-6 py-3 rounded-full shadow-xl" style="background: #a7e3dd; color: #1e3a39; border: 2px solid white;">
										{{ theme.medias|length }}
										{% if theme.medias|length > 1 %} √©l√©ments{% else %} √©l√©ment{% endif %}
									</div>
								</div>

								<!-- Grille des m√©dias -->
								<div class="p-8">
									<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-8">
										{% for media in theme.medias %}
											<div class="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-2xl cursor-pointer media-item border-2 border-gray-200 transition-all duration-300" style="hover:border-color: #a7e3dd;" onclick="openModal('{{ media.id }}', '{{ media.type }}', '{{ media.filename }}', '{{ media.titre }}', '{{ media.description }}')">

												{% if media.type == 'IMAGE' %}
													<div class="h-80 bg-gray-200 relative">
														<img src="/uploads/gallery/{{ media.filename }}" alt="{{ media.title }}" class="w-full h-full object-cover">
														<div class="absolute top-3 right-3">
															<span class="bg-black bg-opacity-60 text-white text-sm px-3 py-1 rounded-full">üì∑</span>
														</div>
													</div>
												{% else %}
													<div class="h-80 bg-gray-800 relative flex items-center justify-center">
														<div class="text-white text-center">
															<div class="text-6xl mb-4">üé¨</div>
															<div class="text-lg font-semibold">Vid√©o</div>
														</div>
														<div class="absolute top-3 right-3">
															<span class="bg-black bg-opacity-60 text-white text-sm px-3 py-1 rounded-full">üé•</span>
														</div>
													</div>
												{% endif %}

												<div class="p-6">
													<h3 class="font-black text-gray-900 text-xl mb-4">{{ media.titre }}</h3>
													{% if media.description %}
														<div class="rounded-lg p-5 mb-5 min-h-[140px]" style="background: #f0faf9; border-left: 6px solid #a7e3dd;">
															<p class="text-gray-900 text-lg leading-relaxed font-medium">{{ media.description }}</p>
														</div>
													{% else %}
														<div class="rounded-lg p-5 mb-5 min-h-[140px] flex items-center justify-center" style="background: #f9f9f9;">
															<p class="text-gray-500 text-base italic">Aucune description disponible</p>
														</div>
													{% endif %}
													<div class="flex justify-between items-center pt-3 border-t-2" style="border-color: #e6f7f5;">
														<div class="text-base text-gray-700 px-4 py-2 rounded-full font-bold" style="background: #e6f7f5;">
															üìÖ {{ media.createdAt|date('d/m/Y') }}
														</div>
														<div class="text-base font-bold px-4 py-2 rounded-full hover:opacity-80 transition-opacity" style="background: #a7e3dd; color: #2d5a56;">
															üëÅÔ∏è Voir en grand
														</div>
													</div>
												</div>
											</div>
										{% endfor %}
									</div>
								</div>
							</div>
						</div>
					{% endif %}
				{% endfor %}
			{% else %}
				<div class="text-center py-16">
					<div class="text-6xl mb-4">üì∏</div>
					<h2 class="text-2xl font-bold text-gray-600 mb-2">Aucune image pour le moment</h2>
					<p class="text-gray-500">La galerie sera bient√¥t remplie de beaux souvenirs !</p>
				</div>
			{% endif %}
		</div>
	</div>

	<!-- Modal pour afficher les m√©dias -->
	<div id="mediaModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 items-center justify-center" style="display: none;">
		<div class="bg-white rounded-xl max-w-5xl max-h-screen m-4 overflow-hidden shadow-2xl">
			<div class="flex justify-between items-center p-6 border-b border-gray-200 bg-slate-50">
				<h3 id="modalTitle" class="text-2xl font-bold text-slate-900"></h3>
				<button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 text-3xl font-bold p-2 hover:bg-slate-200 rounded-full transition-colors">&times;</button>
			</div>

			<div class="p-6">
				<div
					id="modalContent" class="text-center mb-6"><!-- Le contenu sera inject√© ici -->
				</div>
				<div id="modalDescription" class="bg-slate-100 rounded-lg p-4">
					<div class="text-slate-800 text-base leading-relaxed"></div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.line-clamp-2 {
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			overflow: hidden;
		}

		.media-item {
			transition: all 0.3s ease;
			border: 2px solid transparent;
		}

		.media-item:hover {
			transform: translateY(-4px);
			box-shadow: 0 20px 25px -5px rgba(167, 227, 221, 0.3), 0 10px 10px -5px rgba(167, 227, 221, 0.2);
			border-color: #a7e3dd !important;
		}

		.aspect-square {
			aspect-ratio: 1 / 1;
		}

		/* Am√©liorer le contraste des textes */
		.media-item h3 {
			color: #1f2937 !important;
			font-weight: 700 !important;
		}

		.media-item p {
			color: #374151 !important;
		}

		/* Animation du modal */
		#mediaModal {
			backdrop-filter: blur(4px);
		}

		#mediaModal > div {
			animation: modalSlideIn 0.3s ease-out;
		}

		@keyframes modalSlideIn {
			from {
				opacity: 0;
				transform: scale(0.9) translateY(-20px);
			}
			to {
				opacity: 1;
				transform: scale(1) translateY(0);
			}
		}
	</style>

	<script>
		function openModal(id, type, filename, title, description) {
const modal = document.getElementById('mediaModal');
const modalTitle = document.getElementById('modalTitle');
const modalContent = document.getElementById('modalContent');
const modalDescription = document.getElementById('modalDescription');

modalTitle.textContent = title;

// Am√©liorer l'affichage de la description
const descriptionDiv = modalDescription.querySelector('div');
if (description && description.trim()) {
descriptionDiv.innerHTML = `<strong class="text-slate-900 block mb-2">Description :</strong>${
description.replace(/\n/g, '<br>')
}`;
modalDescription.style.display = 'block';
} else {
modalDescription.style.display = 'none';
}

if (type === 'IMAGE') {
modalContent.innerHTML = `<img src="/uploads/gallery/${filename}" alt="${title}" class="max-w-full max-h-[70vh] object-contain rounded-lg shadow-lg">`;
} else {
modalContent.innerHTML = `
					<video controls class="max-w-full max-h-[70vh] rounded-lg shadow-lg">
						<source src="/uploads/gallery/${filename}" type="video/mp4">
						Votre navigateur ne supporte pas la lecture vid√©o.
					</video>
				`;
} modal.style.display = 'flex';
document.body.style.overflow = 'hidden';
}

function closeModal() {
const modal = document.getElementById('mediaModal');
modal.style.display = 'none';
document.body.style.overflow = 'auto';

// Arr√™ter la vid√©o si elle joue
const video = modal.querySelector('video');
if (video) {
video.pause();
}
}

// Fermer la modal avec Escape
document.addEventListener('keydown', function (e) {
if (e.key === 'Escape') {
closeModal();
}
});

// Fermer la modal en cliquant en dehors
document.getElementById('mediaModal').addEventListener('click', function (e) {
if (e.target === this) {
closeModal();
}
});
	</script>

{% endblock %}
