{% extends "../layouts/base.twig" %}

{% block main %}
	<div class="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 py-8">
		<div
			class="container mx-auto px-4">

			<!-- Header -->
			<div class="text-center mb-12">
				<h1 class="text-4xl font-bold text-gray-800 mb-4">Images et VidÃ©os</h1>
				<p class="text-lg text-gray-600">DÃ©couvrez les moments forts de notre Ã©cole</p>

				{% if user and (user.role == 'ADMIN' or user.role == 'DIRECTION' or user.role == 'GESTIONNAIRE_SITE') %}
					<div class="mt-6">
						<a href="/gallery/admin" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
							ðŸ”§ GÃ©rer la galerie
						</a>
					</div>
				{% endif %}
			</div>

			<!-- Galerie par thÃ¨mes -->
			{% if themes|length > 0 %}
				{% for theme in themes %}
					{% if theme.medias|length > 0 %}
						<div class="mb-16">
							<div
								class="bg-white rounded-xl shadow-lg overflow-hidden">

								<!-- En-tÃªte du thÃ¨me -->
								<div class="bg-gradient-to-r from-slate-800 to-slate-900 text-white p-6">
									<h2 class="text-3xl font-bold mb-3">{{ theme.name }}</h2>
									{% if theme.description %}
										<p class="text-slate-200 text-lg font-medium">{{ theme.description }}</p>
									{% endif %}
									<div class="text-sm mt-3 bg-white bg-opacity-20 inline-block px-3 py-1 rounded-full">
										{{ theme.medias|length }}
										{% if theme.medias|length > 1 %}Ã©lÃ©ments{% else %}Ã©lÃ©ment
										{% endif %}
									</div>
								</div>

								<!-- Grille des mÃ©dias -->
								<div class="p-6">
									<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
										{% for media in theme.medias %}
											<div class="bg-gray-50 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow cursor-pointer media-item" onclick="openModal('{{ media.id }}', '{{ media.type }}', '{{ media.filename }}', '{{ media.title }}', '{{ media.description }}')">

												{% if media.type == 'IMAGE' %}
													<div class="aspect-square bg-gray-200 relative">
														<img src="/uploads/gallery/{{ media.filename }}" alt="{{ media.title }}" class="w-full h-full object-cover">
														<div class="absolute top-2 right-2">
															<span class="bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">ðŸ“·</span>
														</div>
													</div>
												{% else %}
													<div class="aspect-square bg-gray-800 relative flex items-center justify-center">
														<div class="text-white text-center">
															<div class="text-4xl mb-2">ðŸŽ¬</div>
															<div class="text-sm">VidÃ©o</div>
														</div>
														<div class="absolute top-2 right-2">
															<span class="bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">ðŸŽ¥</span>
														</div>
													</div>
												{% endif %}

												<div class="p-4">
													<h3 class="font-bold text-gray-900 text-base mb-2">{{ media.title }}</h3>
													{% if media.description %}
														<div class="bg-gray-100 rounded-lg p-3 mb-3">
															<p class="text-gray-800 text-sm leading-relaxed">{{ media.description }}</p>
														</div>
													{% endif %}
													<div class="flex justify-between items-center">
														<div class="text-xs text-gray-600 bg-gray-200 px-2 py-1 rounded">
															{{ media.createdAt|date('d/m/Y') }}
														</div>
														<div class="text-xs text-blue-600 font-medium">
															Cliquer pour agrandir
														</div>
													</div>
												</div>
											</div>
										{% endfor %}
									</div>
								</div>
							</div>
						</div>
					{% endif %}
				{% endfor %}
			{% else %}
				<div class="text-center py-16">
					<div class="text-6xl mb-4">ðŸ“¸</div>
					<h2 class="text-2xl font-bold text-gray-600 mb-2">Aucune image pour le moment</h2>
					<p class="text-gray-500">La galerie sera bientÃ´t remplie de beaux souvenirs !</p>
				</div>
			{% endif %}
		</div>
	</div>

	<!-- Modal pour afficher les mÃ©dias -->
	<div id="mediaModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 items-center justify-center" style="display: none;">
		<div class="bg-white rounded-xl max-w-5xl max-h-screen m-4 overflow-hidden shadow-2xl">
			<div class="flex justify-between items-center p-6 border-b border-gray-200 bg-slate-50">
				<h3 id="modalTitle" class="text-2xl font-bold text-slate-900"></h3>
				<button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 text-3xl font-bold p-2 hover:bg-slate-200 rounded-full transition-colors">&times;</button>
			</div>

			<div class="p-6">
				<div
					id="modalContent" class="text-center mb-6"><!-- Le contenu sera injectÃ© ici -->
				</div>
				<div id="modalDescription" class="bg-slate-100 rounded-lg p-4">
					<div class="text-slate-800 text-base leading-relaxed"></div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.line-clamp-2 {
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			overflow: hidden;
		}

		.media-item {
			transition: all 0.3s ease;
			border: 2px solid transparent;
		}

		.media-item:hover {
			transform: translateY(-4px);
			box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
			border-color: #3b82f6;
		}

		.aspect-square {
			aspect-ratio: 1 / 1;
		}

		/* AmÃ©liorer le contraste des textes */
		.media-item h3 {
			color: #1f2937 !important;
			font-weight: 700 !important;
		}

		.media-item p {
			color: #374151 !important;
		}

		/* Animation du modal */
		#mediaModal {
			backdrop-filter: blur(4px);
		}

		#mediaModal > div {
			animation: modalSlideIn 0.3s ease-out;
		}

		@keyframes modalSlideIn {
			from {
				opacity: 0;
				transform: scale(0.9) translateY(-20px);
			}
			to {
				opacity: 1;
				transform: scale(1) translateY(0);
			}
		}
	</style>

	<script>
		function openModal(id, type, filename, title, description) {
const modal = document.getElementById('mediaModal');
const modalTitle = document.getElementById('modalTitle');
const modalContent = document.getElementById('modalContent');
const modalDescription = document.getElementById('modalDescription');

modalTitle.textContent = title;

// AmÃ©liorer l'affichage de la description
const descriptionDiv = modalDescription.querySelector('div');
if (description && description.trim()) {
descriptionDiv.innerHTML = `<strong class="text-slate-900 block mb-2">Description :</strong>${
description.replace(/\n/g, '<br>')
}`;
modalDescription.style.display = 'block';
} else {
modalDescription.style.display = 'none';
}

if (type === 'IMAGE') {
modalContent.innerHTML = `<img src="/uploads/gallery/${filename}" alt="${title}" class="max-w-full max-h-[70vh] object-contain rounded-lg shadow-lg">`;
} else {
modalContent.innerHTML = `
					<video controls class="max-w-full max-h-[70vh] rounded-lg shadow-lg">
						<source src="/uploads/gallery/${filename}" type="video/mp4">
						Votre navigateur ne supporte pas la lecture vidÃ©o.
					</video>
				`;
} modal.style.display = 'flex';
document.body.style.overflow = 'hidden';
}

function closeModal() {
const modal = document.getElementById('mediaModal');
modal.style.display = 'none';
document.body.style.overflow = 'auto';

// ArrÃªter la vidÃ©o si elle joue
const video = modal.querySelector('video');
if (video) {
video.pause();
}
}

// Fermer la modal avec Escape
document.addEventListener('keydown', function (e) {
if (e.key === 'Escape') {
closeModal();
}
});

// Fermer la modal en cliquant en dehors
document.getElementById('mediaModal').addEventListener('click', function (e) {
if (e.target === this) {
closeModal();
}
});
	</script>

{% endblock %}
