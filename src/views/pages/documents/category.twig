{% extends "layouts/base.twig" %}

{% block title %}
	{{ pageTitle }}
	- √âcole Saint-Mathieu
{% endblock %}

{% block main %}
	<div
		class="container mx-auto p-4 font-poppins">
		<!-- Header Section -->
		<h1 class="text-4xl md:text-5xl font-bold mb-6 text-[#304a4d]" style="font-size: 2.8rem !important;">
			{% if category == 'ecole' %}
				üìÑ Documents Officiels de l'√âcole
			{% elseif category == 'pastorale' %}
				‚úùÔ∏è Documents Pastorale
			{% elseif category == 'apel' %}
				ü§ù Documents APEL
			{% endif %}
		</h1>

		<!-- Info Alert -->
		<div class="alert alert-info permanent mb-6">
			<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
			</svg>
			<div>
				<h3 class="font-bold text-lg" style="font-size: 1.2rem !important;">
					{% if category == 'ecole' %}
						Documents p√©dagogiques et administratifs
					{% elseif category == 'pastorale' %}
						Documents spirituels et pastoraux
					{% elseif category == 'apel' %}
						Documents de l'Association de Parents d'√âl√®ves
					{% endif %}
				</h3>
				<div class="text-base" style="font-size: 1rem !important;">
					{% if category == 'ecole' %}
						Retrouvez tous les documents officiels, projets √©ducatifs et chartes de l'√©cole
					{% elseif category == 'pastorale' %}
						D√©couvrez les documents relatifs √† la pastorale et √† la spiritualit√© de l'√©cole
					{% elseif category == 'apel' %}
						Comptes-rendus, projets et informations de l'APEL de l'√©cole
					{% endif %}
				</div>
			</div>
		</div>

		<!-- Documents Grid -->
		{% if documentsByType and documentsByType|length > 0 %}
			<div
				class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

				{# Carte sp√©ciale pour Projet √©ducatif + Projet d'√©tablissement (acc√®s public) #}
				{% if documentsByType['PROJET_EDUCATIF'] or documentsByType['PROJET_ETABLISSEMENT'] %}
					<div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-300 border-l-4 border-green-500">
						<div class="card-body">
							<div class="flex items-start justify-between mb-3">
								<h3 class="card-title text-[#304a4d] text-xl" style="font-size: 1.3rem !important;">
									üìã Projet √©ducatif & d'√©tablissement
								</h3>
								<div class="badge badge-success badge-sm">üåç Acc√®s public</div>
							</div>

							<p class="text-slate-600 text-base mb-4 leading-relaxed" style="font-size: 1rem !important;">
								D√©couvrez notre vision √©ducative et nos objectifs d'√©tablissement
							</p>

							<div
								class="space-y-2 mb-4">
								{# Documents Projet √©ducatif #}
								{% if documentsByType['PROJET_EDUCATIF'] %}
									{% for doc in documentsByType['PROJET_EDUCATIF'] %}
										<div class="flex items-center justify-between p-2 bg-slate-50 rounded">
											<span class="text-base font-medium" style="font-size: 1rem !important;">üìã
												{{ doc.titre }}</span>
											<div class="flex gap-1">
												{% if doc.contenu %}
													<a href="/documents/show/{{ doc.id }}" class="btn btn-xs btn-primary">
														<svg class="w-3 h-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
														</svg>
													</a>
												{% endif %}
												{% if doc.isExternalLink and doc.externalUrl %}
													<a href="{{ doc.externalUrl }}" target="_blank" class="btn btn-xs btn-accent">
														üîó
													</a>
												{% elseif doc.pdfUrl %}
													<a href="{{ doc.pdfUrl }}" target="_blank" class="btn btn-xs btn-secondary">
														üìÑ
													</a>
												{% endif %}
											</div>
										</div>
									{% endfor %}
								{% endif %}

								{# Documents Projet d'√©tablissement #}
								{% if documentsByType['PROJET_ETABLISSEMENT'] %}
									{% for doc in documentsByType['PROJET_ETABLISSEMENT'] %}
										<div class="flex items-center justify-between p-2 bg-slate-50 rounded">
											<span class="text-base font-medium" style="font-size: 1rem !important;">üè´
												{{ doc.titre }}</span>
											<div class="flex gap-1">
												{% if doc.contenu %}
													<a href="/documents/show/{{ doc.id }}" class="btn btn-xs btn-primary">
														<svg class="w-3 h-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
														</svg>
													</a>
												{% endif %}
												{% if doc.isExternalLink and doc.externalUrl %}
													<a href="{{ doc.externalUrl }}" target="_blank" class="btn btn-xs btn-accent">
														üîó
													</a>
												{% elseif doc.pdfUrl %}
													<a href="{{ doc.pdfUrl }}" target="_blank" class="btn btn-xs btn-secondary">
														üìÑ
													</a>
												{% endif %}
											</div>
										</div>
									{% endfor %}
								{% endif %}
							</div>
						</div>
					</div>
				{% endif %}

				{# Documents publics individuels #}
				{% for type, documents in documentsByType %}
					{% if type == 'REGLEMENT_INTERIEUR' or type == 'DOSSIER_INSCRIPTION' %}
						<div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-300 border-l-4 border-green-500">
							<div class="card-body">
								<div class="flex items-start justify-between mb-3">
									<h3 class="card-title text-[#304a4d] text-xl" style="font-size: 1.3rem !important;">
										{% if type == 'REGLEMENT_INTERIEUR' %}üìú R√®glement int√©rieur
											{% elseif type == 'DOSSIER_INSCRIPTION' %}üìù Dossier d'inscription
										{% endif %}
									</h3>

									<div class="flex flex-col gap-1">
										<div class="badge badge-success badge-sm">üìÅ
											{{ documents|length }}
											document{{ documents|length > 1 ? 's' : '' }}</div>
										<div class="badge badge-success badge-sm">üåç Acc√®s public</div>
									</div>
								</div>

								<p class="text-slate-600 text-base mb-4 leading-relaxed" style="font-size: 1rem !important;">
									{% if type == 'REGLEMENT_INTERIEUR' %}
										Le r√®glement int√©rieur d√©finit les r√®gles de vie de l'√©cole
									{% elseif type == 'DOSSIER_INSCRIPTION' %}
										Documents n√©cessaires pour l'inscription √† l'√©cole
									{% endif %}
								</p>

								{# Liste des documents #}
								<div class="space-y-2 mb-4">
									{% for document in documents %}
										<div class="flex items-center justify-between p-2 bg-slate-50 rounded">
											<div class="flex-1">
												<span class="text-base font-medium" style="font-size: 1rem !important;">{{ document.titre }}</span>
												<div class="text-sm text-slate-500" style="font-size: 0.9rem !important;">
													Mis √† jour le
													{{ document.updatedAt|date('d/m/Y') }}
													{% if document.auteur %}
														par
														{{ document.auteur.firstName }}
														{{ document.auteur.lastName }}
													{% endif %}
												</div>
											</div>
											<div class="flex gap-1">
												{% if document.contenu %}
													<a href="/documents/show/{{ document.id }}" class="btn btn-xs btn-primary" title="Consulter">
														<svg class="w-3 h-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
														</svg>
													</a>
												{% endif %}
												{% if document.pdfUrl %}
													<a href="{{ document.pdfUrl }}" target="_blank" class="btn btn-xs btn-secondary" title="T√©l√©charger PDF">
														üìÑ
													</a>
												{% endif %}
												{% if document.isExternalLink and document.externalUrl %}
													<a href="{{ document.externalUrl }}" target="_blank" class="btn btn-xs btn-accent" title="Lien externe">
														üîó
													</a>
												{% endif %}
											</div>
										</div>
									{% endfor %}
								</div>
							</div>
						</div>
					{% endif %}
				{% endfor %}

				{# Documents priv√©s (acc√®s restreint) #}
				{% for type, documents in documentsByType %}
					{% if type == 'ORGANIGRAMME' or type == 'CHARTE_LAICITE' or type == 'CHARTE_NUMERIQUE' or type == 'CHARTE_VIE_SCOLAIRE' or type == 'CHARTE_RESTAURATION' %}
						{% set document = documents[0] %}

						{# V√©rifier si l'utilisateur est connect√© #}
						{% if isAuthenticated %}
							<div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-300 border-l-4 border-orange-500">
								<div class="card-body">
									<div class="flex items-start justify-between mb-3">
										<h3 class="card-title text-[#304a4d] text-xl" style="font-size: 1.3rem !important;">
											{% if type == 'ORGANIGRAMME' %}üèóÔ∏è Organigramme
												{% elseif type == 'CHARTE_LAICITE' %}‚öñÔ∏è Charte de la la√Øcit√©
												{% elseif type == 'CHARTE_NUMERIQUE' %}üíª Charte du num√©rique
												{% elseif type == 'CHARTE_VIE_SCOLAIRE' %}üéì Charte de vie scolaire
												{% elseif type == 'CHARTE_RESTAURATION' %}üçΩÔ∏è Charte de restauration
												{% else %}üìÑ
												{{ type|replace('_', ' ')|title }}
											{% endif %}
										</h3>

										<div class="flex flex-col gap-1">
											{% if document.active %}
												<div class="badge badge-success badge-sm">‚úÖ Disponible</div>
											{% else %}
												<div class="badge badge-warning badge-sm">‚è≥ En pr√©paration</div>
											{% endif %}
											<div class="badge badge-warning badge-sm">üîí Acc√®s restreint</div>
										</div>
									</div>

									{% if document.description %}
										<p class="text-slate-600 text-base mb-4 leading-relaxed" style="font-size: 1rem !important;">
											{{ document.description }}
										</p>
									{% endif %}

									<div class="text-sm text-slate-500 mb-4" style="font-size: 0.9rem !important;">
										<div class="flex items-center">
											<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
											</svg>
											Mis √† jour le
											{{ document.updatedAt|date('d/m/Y') }}
										</div>
									</div>

									<div class="card-actions justify-end mt-auto">
										{% if document.contenu %}
											<a href="/documents/show/{{ document.id }}" class="btn btn-primary btn-sm">
												<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
												</svg>
												Consulter
											</a>
										{% endif %}

										{% if document.pdfUrl %}
											<a href="{{ document.pdfUrl }}" target="_blank" class="btn btn-secondary btn-sm">
												<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
												</svg>
												PDF
											</a>
										{% endif %}
									</div>
								</div>
							</div>
						{% else %}
							{# Affichage pour les visiteurs non connect√©s #}
							<div class="card bg-slate-100 shadow-lg border-l-4 border-slate-400">
								<div class="card-body">
									<div class="flex items-start justify-between mb-3">
										<h3 class="card-title text-slate-500 text-xl" style="font-size: 1.3rem !important;">
											{% if type == 'ORGANIGRAMME' %}üèóÔ∏è Organigramme
												{% elseif type == 'CHARTE_LAICITE' %}‚öñÔ∏è Charte de la la√Øcit√©
												{% elseif type == 'CHARTE_NUMERIQUE' %}üíª Charte du num√©rique
												{% elseif type == 'CHARTE_VIE_SCOLAIRE' %}üéì Charte de vie scolaire
												{% elseif type == 'CHARTE_RESTAURATION' %}üçΩÔ∏è Charte de restauration
												{% else %}üìÑ
												{{ type|replace('_', ' ')|title }}
											{% endif %}
										</h3>
										<div class="badge badge-warning badge-sm">üîí Connexion requise</div>
									</div>

									<p class="text-slate-500 text-base mb-4" style="font-size: 1rem !important;">
										Ce document est r√©serv√© aux membres de la communaut√© √©ducative.
									</p>

									<div class="card-actions justify-center">
										<a href="/auth/login" class="btn btn-outline btn-sm">
											üîê Se connecter pour acc√©der
										</a>
									</div>
								</div>
							</div>
						{% endif %}
					{% endif %}
				{% endfor %}

				{# Documents pastorale (toujours publics) #}
				{% for type, documents in documentsByType %}
					{% if type starts with 'PASTORALE_' %}
						<div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-300 border-l-4 border-purple-500">
							<div class="card-body">
								<div class="flex items-start justify-between mb-3">
									<h3 class="card-title text-[#304a4d] text-xl" style="font-size: 1.3rem !important;">
										{% if type == 'PASTORALE_AXE' %}‚úùÔ∏è Axe Pastoral
											{% elseif type == 'PASTORALE_TEMPS_PRIANT' %}üôè Temps Priant
											{% elseif type == 'PASTORALE_ENSEMBLE' %}‚õ™ Ensemble pastoral
											{% else %}üìÑ
											{{ type|replace('_', ' ')|title }}
										{% endif %}
									</h3>

									<div class="flex flex-col gap-1">
										<div class="badge badge-success badge-sm">üìÅ
											{{ documents|length }}
											document{{ documents|length > 1 ? 's' : '' }}</div>
										<div class="badge badge-success badge-sm">üåç Acc√®s public</div>
									</div>
								</div>

								<p class="text-slate-600 text-base mb-4 leading-relaxed" style="font-size: 1rem !important;">
									{% if type == 'PASTORALE_AXE' %}
										Documents relatifs √† l'axe pastoral de l'√©cole
									{% elseif type == 'PASTORALE_TEMPS_PRIANT' %}
										Documents pour les temps de pri√®re et de recueillement
									{% elseif type == 'PASTORALE_ENSEMBLE' %}
										Documents de l'ensemble pastoral
									{% else %}
										Documents spirituels et pastoraux
									{% endif %}
								</p>

								{# Liste des documents #}
								<div class="space-y-2 mb-4">
									{% for document in documents %}
										<div class="flex items-center justify-between p-2 bg-slate-50 rounded">
											<div class="flex-1">
												<span class="text-base font-medium" style="font-size: 1rem !important;">{{ document.titre }}</span>
												{% if document.description %}
													<div class="text-sm text-slate-600 mt-1" style="font-size: 0.85rem !important;">{{ document.description }}</div>
												{% endif %}
												<div class="text-sm text-slate-500" style="font-size: 0.9rem !important;">
													Mis √† jour le
													{{ document.updatedAt|date('d/m/Y') }}
													{% if document.auteur %}
														par
														{{ document.auteur.firstName }}
														{{ document.auteur.lastName }}
													{% endif %}
												</div>
											</div>
											<div class="flex gap-1">
												{% if document.contenu %}
													<a href="/documents/show/{{ document.id }}" class="btn btn-xs btn-primary" title="Consulter">
														<svg class="w-3 h-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
														</svg>
													</a>
												{% endif %}
												{% if document.pdfUrl %}
													<a href="{{ document.pdfUrl }}" target="_blank" class="btn btn-xs btn-secondary" title="T√©l√©charger PDF">
														üìÑ
													</a>
												{% endif %}
												{% if document.isExternalLink and document.externalUrl %}
													<a href="{{ document.externalUrl }}" target="_blank" class="btn btn-xs btn-accent" title="Lien externe">
														üîó
													</a>
												{% endif %}
											</div>
										</div>
									{% endfor %}
								</div>
							</div>
						</div>
					{% endif %}
				{% endfor %}

				{# Documents APEL (acc√®s restreint aux connect√©s) #}
				{% for type, documents in documentsByType %}
					{% if type starts with 'APEL_' %}
						{% if isAuthenticated %}
							<div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-300 border-l-4 border-orange-500">
								<div class="card-body">
									<div class="flex items-start justify-between mb-3">
										<h3 class="card-title text-[#304a4d] text-xl" style="font-size: 1.3rem !important;">
											{% if type == 'APEL_COMPTES_RENDUS' %}üìã Comptes-rendus APEL
												{% elseif type == 'APEL_PROJETS' %}üéØ Projets APEL
												{% elseif type == 'APEL_INFORMATIONS' %}‚ÑπÔ∏è Informations APEL
												{% elseif type == 'APEL_EVENEMENTS' %}üéâ √âv√©nements APEL
												{% else %}üìÑ
												{{ type|replace('_', ' ')|title }}
											{% endif %}
										</h3>

										<div class="flex flex-col gap-1">
											<div class="badge badge-warning badge-sm">üìÅ
												{{ documents|length }}
												document{{ documents|length > 1 ? 's' : '' }}</div>
											<div class="badge badge-warning badge-sm">üîí Acc√®s restreint</div>
										</div>
									</div>

									<p class="text-slate-600 text-base mb-4 leading-relaxed" style="font-size: 1rem !important;">
										{% if type == 'APEL_COMPTES_RENDUS' %}
											Comptes-rendus des r√©unions et assembl√©es de l'APEL
										{% elseif type == 'APEL_PROJETS' %}
											Projets et initiatives port√©s par l'APEL
										{% elseif type == 'APEL_INFORMATIONS' %}
											Informations g√©n√©rales et communications de l'APEL
										{% elseif type == 'APEL_EVENEMENTS' %}
											√âv√©nements organis√©s par l'APEL
										{% else %}
											Documents de l'Association de Parents d'√âl√®ves
										{% endif %}
									</p>

									{# Liste des documents #}
									<div class="space-y-2 mb-4">
										{% for document in documents %}
											<div class="flex items-center justify-between p-2 bg-slate-50 rounded">
												<div class="flex-1">
													<span class="text-base font-medium" style="font-size: 1rem !important;">{{ document.titre }}</span>
													{% if document.description %}
														<div class="text-sm text-slate-600 mt-1" style="font-size: 0.85rem !important;">{{ document.description }}</div>
													{% endif %}
													<div class="text-sm text-slate-500" style="font-size: 0.9rem !important;">
														Mis √† jour le
														{{ document.updatedAt|date('d/m/Y') }}
														{% if document.auteur %}
															par
															{{ document.auteur.firstName }}
															{{ document.auteur.lastName }}
														{% endif %}
													</div>
												</div>
												<div class="flex gap-1">
													{% if document.contenu %}
														<a href="/documents/show/{{ document.id }}" class="btn btn-xs btn-primary" title="Consulter">
															<svg class="w-3 h-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
																<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
															</svg>
														</a>
													{% endif %}
													{% if document.pdfUrl %}
														<a href="{{ document.pdfUrl }}" target="_blank" class="btn btn-xs btn-secondary" title="T√©l√©charger PDF">
															üìÑ
														</a>
													{% endif %}
													{% if document.isExternalLink and document.externalUrl %}
														<a href="{{ document.externalUrl }}" target="_blank" class="btn btn-xs btn-accent" title="Lien externe">
															üîó
														</a>
													{% endif %}
												</div>
											</div>
										{% endfor %}
									</div>
								</div>
							</div>
						{% else %}
							{# Affichage pour les visiteurs non connect√©s #}
							<div class="card bg-slate-100 shadow-lg border-l-4 border-slate-400">
								<div class="card-body">
									<div class="flex items-start justify-between mb-3">
										<h3 class="card-title text-slate-500 text-xl" style="font-size: 1.3rem !important;">
											{% if type == 'APEL_COMPTES_RENDUS' %}üìã Comptes-rendus APEL
												{% elseif type == 'APEL_PROJETS' %}üéØ Projets APEL
												{% elseif type == 'APEL_INFORMATIONS' %}‚ÑπÔ∏è Informations APEL
												{% elseif type == 'APEL_EVENEMENTS' %}üéâ √âv√©nements APEL
												{% else %}üìÑ
												{{ type|replace('_', ' ')|title }}
											{% endif %}
										</h3>
										<div class="badge badge-warning badge-sm">üîí Connexion requise</div>
									</div>

									<p class="text-slate-500 text-base mb-4" style="font-size: 1rem !important;">
										Ces documents sont r√©serv√©s aux membres de la communaut√© √©ducative.
									</p>

									<div class="card-actions justify-center">
										<a href="/auth/login" class="btn btn-outline btn-sm">
											üîê Se connecter pour acc√©der
										</a>
									</div>
								</div>
							</div>
						{% endif %}
					{% endif %}
				{% endfor %}
			</div>
		{% else %}
			<div class="alert alert-warning permanent">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"></path>
				</svg>
				<div>
					<h3 class="font-bold text-lg" style="font-size: 1.2rem !important;">Aucun document disponible</h3>
					<div class="text-base" style="font-size: 1rem !important;">
						{% if category == 'ecole' %}
							Les documents de l'√©cole seront bient√¥t disponibles.
						{% elseif category == 'pastorale' %}
							Les documents de la pastorale seront bient√¥t disponibles.
						{% elseif category == 'apel' %}
							Les documents de l'APEL seront bient√¥t disponibles.
						{% endif %}
					</div>
				</div>
			</div>
		{% endif %}

		<!-- Navigation -->
		<div class="mt-8 text-center">
			<a href="/" class="btn btn-outline">
				<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
				</svg>
				Retour √† l'accueil
			</a>
		</div>
	</div>
{% endblock %}
