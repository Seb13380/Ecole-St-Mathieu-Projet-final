{% extends "layouts/main.twig" %}

{% block content %}
	<div class="min-h-screen bg-gradient-to-br from-[#a7e3dd] to-[#8dd3cc] py-12">
		<div class="container mx-auto px-4">
			<div class="max-w-4xl mx-auto">
				<!-- En-t√™te -->
				<div class="text-center mb-8">
					<h1 class="text-4xl font-bold text-[#304a4d] mb-4">
						üéì Demande d'Inscription √âl√®ve
					</h1>
					<p class="text-lg text-[#304a4d]/80" id="inscriptionSubtitle">
						Demande d'inscription pour l'ann√©e scolaire 2025-2026
					</p>
				</div>

				<!-- Documents √† t√©l√©charger -->
				<div id="documentsSection" class="mb-8" style="display: none;">
					<div class="bg-white rounded-xl shadow-lg p-6">
						<h2 class="text-2xl font-semibold text-[#304a4d] mb-4">
							üìÅ Documents √† t√©l√©charger
						</h2>
						<p class="text-[#304a4d]/80 mb-4">
							T√©l√©chargez et consultez les documents n√©cessaires pour l'inscription :
						</p>
						<div id="documentsList" class="space-y-3">
							<!-- Les documents seront ajout√©s ici par JavaScript -->
						</div>
					</div>
				</div>

				<!-- Messages flash -->
				{% if success %}
					<div class="alert alert-success mb-6">
						<span>‚úÖ {{ success }}</span>
					</div>
				{% endif %}

				{% if error %}
					<div class="alert alert-error mb-6">
						<span>‚ùå {{ error }}</span>
					</div>
				{% endif %}

				<!-- Formulaire -->
				<div class="bg-white rounded-xl shadow-lg p-8">
					<form action="/inscription-eleve" method="POST" class="space-y-6">

						<!-- Section Parent/Responsable -->
						<div class="border-b border-gray-200 pb-6">
							<h2 class="text-2xl font-semibold text-[#304a4d] mb-4">
								üë§ Informations du Parent/Responsable
							</h2>

							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Pr√©nom *</span>
									</label>
									<input type="text" name="parentFirstName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Nom *</span>
									</label>
									<input type="text" name="parentLastName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Email *</span>
									</label>
									<input type="email" name="parentEmail" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">T√©l√©phone *</span>
									</label>
									<input type="tel" name="parentPhone" class="input input-bordered w-full" required>
								</div>

								<div class="form-control md:col-span-2">
									<label class="label">
										<span class="label-text font-medium">Adresse compl√®te *</span>
									</label>
									<textarea name="parentAddress" class="textarea textarea-bordered w-full" rows="3" required placeholder="Adresse, code postal, ville"></textarea>
								</div>
							</div>
						</div>

						<!-- Section √âl√®ve -->
						<div class="border-b border-gray-200 pb-6">
							<h2 class="text-2xl font-semibold text-[#304a4d] mb-4">
								üßí Informations de l'Enfant √† Inscrire
							</h2>

							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Pr√©nom de l'enfant *</span>
									</label>
									<input type="text" name="studentFirstName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Nom de l'enfant *</span>
									</label>
									<input type="text" name="studentLastName" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Date de naissance *</span>
									</label>
									<input type="date" name="studentBirthDate" class="input input-bordered w-full" required>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Classe actuelle</span>
									</label>
									<select name="currentClass" class="select select-bordered w-full">
										<option value="">S√©lectionner...</option>
										<option value="TPS">TPS (Toute Petite Section)</option>
										<option value="PS">PS (Petite Section)</option>
										<option value="MS">MS (Moyenne Section)</option>
										<option value="GS">GS (Grande Section)</option>
										<option value="CP">CP</option>
										<option value="CE1">CE1</option>
										<option value="CE2">CE2</option>
										<option value="CM1">CM1</option>
										<option value="CM2">CM2</option>
										<option value="Premi√®re_inscription">Premi√®re inscription</option>
										<option value="Autre_√©cole">Autre √©cole</option>
									</select>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Classe demand√©e *</span>
									</label>
									<select name="requestedClass" class="select select-bordered w-full" required>
										<option value="">S√©lectionner la classe souhait√©e...</option>
										<option value="PS">PS (Petite Section)</option>
										<option value="MS">MS (Moyenne Section)</option>
										<option value="GS">GS (Grande Section)</option>
										<option value="CP">CP</option>
										<option value="CE1">CE1</option>
										<option value="CE2">CE2</option>
										<option value="CM1">CM1</option>
										<option value="CM2">CM2</option>
									</select>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">√âcole pr√©c√©dente</span>
									</label>
									<input type="text" name="previousSchool" class="input input-bordered w-full" placeholder="Nom de l'√©cole pr√©c√©dente (si applicable)">
								</div>
							</div>
						</div>

						<!-- Section Informations Compl√©mentaires -->
						<div class="pb-6">
							<h2 class="text-2xl font-semibold text-[#304a4d] mb-4">
								üìã Informations Compl√©mentaires
							</h2>

							<div class="space-y-4">
								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Besoins particuliers ou PAI</span>
									</label>
									<textarea name="specialNeeds" class="textarea textarea-bordered w-full" rows="3" placeholder="Allergie, handicap, troubles d'apprentissage, etc. (facultatif)"></textarea>
								</div>

								<div class="form-control">
									<label class="label">
										<span class="label-text font-medium">Message ou demande particuli√®re</span>
									</label>
									<textarea name="message" class="textarea textarea-bordered w-full" rows="4" placeholder="Votre message pour l'√©quipe p√©dagogique (facultatif)"></textarea>
								</div>
							</div>
						</div>

						<!-- Informations importantes -->
						<div class="bg-blue-50 p-6 rounded-lg">
							<h3 class="text-lg font-semibold text-[#304a4d] mb-3">
								‚ÑπÔ∏è Informations importantes
							</h3>
							<ul class="list-disc list-inside space-y-2 text-[#304a4d]/80">
								<li>Cette demande sera examin√©e par l'√©quipe de direction</li>
								<li>Vous recevrez une r√©ponse par email sous 48h</li>
								<li>En cas d'acceptation, les identifiants de connexion vous seront envoy√©s</li>
								<li>Les places sont limit√©es et attribu√©es selon l'ordre d'arriv√©e et les crit√®res de l'√©cole</li>
								<li>Un entretien peut √™tre demand√© avant l'inscription d√©finitive</li>
							</ul>
						</div>

						<!-- Bouton de soumission -->
						<div class="text-center pt-6">
							<button type="submit" class="btn bg-[#304a4d] hover:bg-[#2a3f42] text-white text-lg px-8 py-3">
								üì§ Envoyer la demande d'inscription
							</button>
						</div>
					</form>
				</div>

				<!-- Informations de contact -->
				<div class="mt-8 text-center">
					<div class="bg-white/50 rounded-lg p-6">
						<h3 class="text-lg font-semibold text-[#304a4d] mb-2">
							Besoin d'aide ?
						</h3>
						<p class="text-[#304a4d]/80">
							Contactez le secr√©tariat au <strong>04 91 05 05 89</strong><br>
							ou par email : <strong>secretariat@ecole-saint-mathieu.fr</strong>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

<script>
// Charger les donn√©es d'inscription (sous-titre et documents)
async function loadInscriptionData() {
    try {
        const response = await fetch('/inscription-management/data');
        const data = await response.json();
        
        if (data.success) {
            // Mettre √† jour le sous-titre
            if (data.config && data.config.soustitre) {
                document.getElementById('inscriptionSubtitle').textContent = data.config.soustitre;
            }
            
            // Afficher les documents s'il y en a
            if (data.documents && data.documents.length > 0) {
                displayDocuments(data.documents);
            }
        }
    } catch (error) {
        console.error('Erreur lors du chargement des donn√©es d\'inscription:', error);
    }
}

function displayDocuments(documents) {
    const documentsSection = document.getElementById('documentsSection');
    const documentsList = document.getElementById('documentsList');
    
    documentsList.innerHTML = '';
    
    documents.forEach(document => {
        const documentDiv = document.createElement('div');
        documentDiv.className = 'flex items-center justify-between bg-slate-50 p-4 rounded-lg border border-slate-200';
        
        const fileSize = (document.taille / 1024 / 1024).toFixed(2);
        
        documentDiv.innerHTML = `
            <div class="flex items-center space-x-3">
                <span class="text-red-500 text-2xl">üìÑ</span>
                <div>
                    <h3 class="font-semibold text-[#304a4d]">${document.nom}</h3>
                    ${document.description ? `<p class="text-sm text-[#304a4d]/70">${document.description}</p>` : ''}
                    <p class="text-xs text-[#304a4d]/60">${fileSize} MB</p>
                </div>
            </div>
            <a href="/inscription-management/documents/${document.id}/download" 
               class="bg-[#304a4d] hover:bg-[#2a3f42] text-white px-4 py-2 rounded-lg transition-colors inline-flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                T√©l√©charger
            </a>
        `;
        
        documentsList.appendChild(documentDiv);
    });
    
    documentsSection.style.display = 'block';
}

// Charger les donn√©es au chargement de la page
document.addEventListener('DOMContentLoaded', loadInscriptionData);
</script>
{% endblock %}
