{% extends "layouts/base.twig" %}

{% block title %}Menu de la semaine - École Saint-Mathieu
{% endblock %}

{% block head %}
	<style>
		/* FORCER LE PLEIN ÉCRAN - Éliminer toutes les contraintes */
		body {
			background: white !important;
			margin: 0 !important;
			padding: 0 !important;
		}

		main {
			min-height: 100vh !important;
			padding: 0 !important;
			margin: 0 !important;
		}

		/* Container PDF en mode plein écran */
		.menu-pdf-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw !important;
			height: 100vh !important;
			margin: 0;
			padding: 0;
			z-index: 1000;
			background: white;
		}

		.menu-pdf-embed {
			width: 100vw !important;
			height: calc(100vh - 140px) !important; /* Moins la barre du haut + navigation */
			border: none !important;
			margin: 0 !important;
			padding: 0 !important;
		}

		/* En-tête avec navigation carrousel */
		.menu-header-compact {
			height: 140px;
			background: linear-gradient(135deg, rgba(249, 250, 251, 0.98), rgba(167, 227, 221, 0.1));
			backdrop-filter: blur(15px);
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			z-index: 1001;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			padding: 15px 20px;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
			border-bottom: 3px solid rgba(167, 227, 221, 0.3);
		}

		/* Navigation carrousel style */
		.carousel-navigation {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 20px;
			margin-bottom: 15px;
			width: 100%;
			max-width: 800px;
		}

		/* Boutons de navigation carrousel */
		.carousel-btn {
			background: linear-gradient(135deg, #f97316, #ea580c);
			color: white;
			border: none;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			cursor: pointer;
			font-size: 18px;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
			display: flex;
			align-items: center;
			justify-content: center;
			text-decoration: none;
		}

		.carousel-btn:hover {
			background: linear-gradient(135deg, #ea580c, #dc2626);
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
		}

		.carousel-btn:disabled {
			background: linear-gradient(135deg, #d1d5db, #9ca3af);
			cursor: not-allowed;
			transform: none;
			box-shadow: 0 2px 8px rgba(156, 163, 175, 0.2);
		}

		/* Centre du carrousel - Informations de la semaine */
		.carousel-center {
			flex: 1;
			text-align: center;
			padding: 0 20px;
		}

		.carousel-week-title {
			font-size: 24px;
			font-weight: bold;
			color: #1f2937;
			margin-bottom: 8px;
			text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
		}

		.carousel-week-dates {
			font-size: 16px;
			color: #6b7280;
			margin-bottom: 8px;
		}

		/* Indicateurs de statut temporel */
		.carousel-status {
			display: inline-block;
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: bold;
			color: white;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.status-presente {
			background: linear-gradient(135deg, #10b981, #059669);
			box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
		}
		.status-passee {
			background: linear-gradient(135deg, #6b7280, #4b5563);
			box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
		}
		.status-future {
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
		}

		/* Actions en bas */
		.carousel-actions {
			display: flex;
			align-items: center;
			justify-content: space-between;
			width: 100%;
			max-width: 800px;
		}

		.carousel-info {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.carousel-controls {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.action-btn {
			background: linear-gradient(135deg, #8b5cf6, #7c3aed);
			color: white;
			border: none;
			border-radius: 8px;
			padding: 8px 16px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 500;
			transition: all 0.3s ease;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			box-shadow: 0 3px 12px rgba(139, 92, 246, 0.3);
		}

		.action-btn:hover {
			background: linear-gradient(135deg, #7c3aed, #6d28d9);
			transform: translateY(-1px);
			box-shadow: 0 4px 16px rgba(139, 92, 246, 0.4);
		}

		.close-btn {
			background: linear-gradient(135deg, #ef4444, #dc2626);
		}

		.close-btn:hover {
			background: linear-gradient(135deg, #dc2626, #b91c1c);
		}

		/* Supprimer tous les autres éléments du layout */
		.main-content {
			position: relative;
			width: 100vw;
			height: 100vh;
			overflow: hidden;
		}

		/* Responsive */
		@media(max-width: 768px) {
			.carousel-navigation {
				flex-direction: column;
				gap: 15px;
			}

			.carousel-center {
				padding: 0 10px;
			}

			.carousel-week-title {
				font-size: 20px;
			}

			.carousel-week-dates {
				font-size: 14px;
			}

			.carousel-btn {
				width: 45px;
				height: 45px;
				font-size: 16px;
			}

			.carousel-actions {
				flex-direction: column;
				gap: 10px;
			}
		}

		/* Animation de transition */
		.menu-transition {
			transition: opacity 0.3s ease-in-out;
		}

		.menu-transition.loading {
			opacity: 0.7;
		}
	</style>
{% endblock %}

{% block main %}
	<div class="main-content">
		{% if menu %}
			<!-- Affichage du PDF avec navigation carrousel -->
			<div
				class="menu-pdf-container">
				<!-- En-tête avec navigation carrousel -->
				<div
					class="menu-header-compact">
					<!-- Navigation carrousel -->
					<div
						class="carousel-navigation">
						<!-- Bouton semaine précédente -->
						{% if menuPrecedent %}
							<a href="/restauration/menus?semaine={{ menuPrecedent.semaineId }}" class="carousel-btn" title="Semaine précédente">
								<i class="fas fa-chevron-left"></i>
							</a>
						{% else %}
							<button class="carousel-btn" disabled title="Pas de semaine précédente">
								<i class="fas fa-chevron-left"></i>
							</button>
						{% endif %}

						<!-- Centre - Informations de la semaine -->
						<div class="carousel-center">
							<div class="carousel-week-title">{{ menu.semaine }}</div>
							<div class="carousel-week-dates">
								{% set menuData = todosLesMenus|filter(m => m.id == menu.id)|first %}
								{% if menuData %}
									{{ menuData.nomSemaine }}
								{% endif %}
							</div>
							{% if menuData %}
								<div class="carousel-status status-{{ menuData.statutTemporel }}">
									{% if menuData.statutTemporel == 'presente' %}
										Cette semaine
									{% elseif menuData.statutTemporel == 'passee' %}
										Semaine passée
									{% else %}
										Semaine à venir
									{% endif %}
								</div>
							{% endif %}
						</div>

						<!-- Bouton semaine suivante -->
						{% if menuSuivant %}
							<a href="/restauration/menus?semaine={{ menuSuivant.semaineId }}" class="carousel-btn" title="Semaine suivante">
								<i class="fas fa-chevron-right"></i>
							</a>
						{% else %}
							<button class="carousel-btn" disabled title="Pas de semaine suivante">
								<i class="fas fa-chevron-right"></i>
							</button>
						{% endif %}
					</div>

					<!-- Actions -->
					<div class="carousel-actions">
						<div class="carousel-info">
							<i class="fas fa-chef-hat" style="color: #f97316; font-size: 20px;"></i>
							<span style="color: #374151; font-weight: 500;">Menu de la restauration</span>
						</div>
						<div class="carousel-controls">
							<a href="{{ menu.pdfUrl }}" target="_blank" class="action-btn" title="Télécharger le PDF">
								<i class="fas fa-download"></i>
								Télécharger
							</a>
							<button onclick="history.back()" class="action-btn close-btn" title="Retour">
								<i class="fas fa-times"></i>
								Fermer
							</button>
						</div>
					</div>
				</div>

				<!-- PDF en plein écran -->
				<div style="margin-top: 140px; height: calc(100vh - 140px);">
					<embed src="{{ menu.pdfUrl }}" type="application/pdf" class="menu-pdf-embed menu-transition">
				</div>
			</div>

		{% else %}
			<!-- Aucun menu disponible -->
			<div class="flex items-center justify-center h-screen">
				<div class="text-center">
					<i class="fas fa-chef-hat text-gray-300 text-6xl mb-4"></i>
					<h2 class="text-2xl font-bold text-gray-800 mb-4">Aucun menu disponible</h2>
					<p class="text-gray-600 mb-4">
						{% if todosLesMenus|length > 0 %}
							Naviguez avec les flèches pour voir les autres semaines
						{% else %}
							Les menus de la semaine seront bientôt disponibles.
						{% endif %}
					</p>

					{% if todosLesMenus|length > 0 %}
						<!-- Mini carrousel de navigation même sans menu -->
						<div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px;">
							{% set firstMenu = todosLesMenus|first %}
							{% if firstMenu %}
								<a href="/restauration/menus?semaine={{ firstMenu.semaineId }}" class="action-btn">
									<i class="fas fa-arrow-right"></i>
									Voir les menus disponibles
								</a>
							{% endif %}
						</div>
					{% endif %}
				</div>
			</div>
		{% endif %}
	</div>

	<script>
		// Animation de transition lors du changement de page
document.addEventListener('DOMContentLoaded', function () {
const menuEmbed = document.querySelector('.menu-transition');
if (menuEmbed) { // Ajouter une classe de chargement lors des clics sur les boutons de navigation
const navButtons = document.querySelectorAll('.carousel-btn');
navButtons.forEach(button => {
button.addEventListener('click', function () {
if (!this.disabled) {
menuEmbed.classList.add('loading');
}
});
});
}
});
	</script>
{% endblock %}
