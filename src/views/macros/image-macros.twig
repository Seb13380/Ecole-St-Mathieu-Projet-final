{# ============================================= #}
{# MACROS OPTIMIS√âES POUR IMAGES WEBP - PERFORMANCE #}
{# Fallback automatique pour compatibilit√© navigateurs #}
{# ============================================= #}

{# 
    Macro principale pour affichage d'images optimis√©es WebP
    Param√®tres:
    - src: URL de l'image source (JPG/PNG)
    - alt: Texte alternatif pour accessibilit√©
    - class: Classes CSS √† appliquer
    - width/height: Dimensions (optionnel)
    - lazy: Chargement paresseux (d√©faut: true)
#}
	{% macro image_optimized(src, alt, class="", width="", height="", lazy=true) %}
		{% if src %}
		{% set webp_src = src|replace({'.jpg': '.webp', '.jpeg': '.webp', '.png': '.webp', '.gif': '.webp'}) %}
		{% set has_extension = src matches '/\\.(jpg|jpeg|png|gif)$/i' %}

			{% if has_extension %}
				<picture
				class="{{ class }}"> <!-- Format WebP pour navigateurs modernes (Chrome, Firefox, Edge, Safari 14+) -->
				<source
				srcset="{{ webp_src }}" type="image/webp">
				<!-- Fallback format original pour compatibilit√© -->
				<img src="{{ src }}" alt="{{ alt|escape }}" {% if width %} width="{{ width }}" {% endif %} {% if height %} height="{{ height }}" {% endif %} {% if lazy %} loading="lazy" decoding="async" {% endif %} style="max-width: 100%; height: auto;" onerror="this.style.display='none'; console.warn('Image non trouv√©e: {{ src|escape('js') }}');">
			</picture>
		{% else %}
			<!-- Image sans extension connue - affichage direct -->
			<img src="{{ src }}" alt="{{ alt|escape }}" class="{{ class }}" {% if width %} width="{{ width }}" {% endif %} {% if height %} height="{{ height }}" {% endif %} {% if lazy %} loading="lazy" decoding="async" {% endif %} style="max-width: 100%; height: auto;" onerror="this.style.display='none'; console.warn('Image non trouv√©e: {{ src|escape('js') }}');">
		{% endif %}
	{% else %}
		<!-- Placeholder si pas d'image -->
		<div class="bg-gray-200 flex items-center justify-center {{ class }}" {% if width %} style="width: {{ width }}; {% else %}style=" width: 100%; {% endif %} {% if height %} height: {{ height }} ; "{% else %}height: 200px;" {% endif %}>
			<span class="text-gray-500 text-sm">{{ alt|default('Image non disponible') }}</span>
		</div>
	{% endif %}
{% endmacro %}

{# 
    Macro sp√©cialis√©e pour images d'actualit√©s avec style coh√©rent
#}
{% macro actualite_image(actualite, class="w-full h-48 object-cover rounded-t-lg") %}
	{% if actualite.image %}
		{{ _self.image_optimized(actualite.image, actualite.titre, class) }}
	{% else %}
		<div class="bg-gradient-to-br from-blue-100 to-teal-100 {{ class }} flex items-center justify-center">
			<div class="text-center">
				<svg class="w-12 h-12 mx-auto text-blue-400 mb-2" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16l4-4 4 4m-4-8a1 1 0 11-2 0 1 1 0 012 0z"></path>
				</svg>
				<span class="text-blue-600 text-sm font-medium">üì∞
					{{ actualite.titre|slice(0, 30) }}{{ actualite.titre|length > 30 ? '...' : '' }}</span>
			</div>
		</div>
	{% endif %}
{% endmacro %}

{# 
    Macro pour images de carousel avec navigation optimis√©e
#}
{% macro carousel_image(image, index, total, class="w-full h-64 object-cover") %}
	<div class="carousel-item" data-index="{{ index }}">
		{{ _self.image_optimized(image.url, image.alt|default('Image ' ~ (index + 1)), class, '', '', false) }}
		{% if image.titre %}
			<div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
				<h3 class="text-white font-semibold">{{ image.titre }}</h3>
				{% if image.description %}
					<p class="text-white/90 text-sm mt-1">{{ image.description }}</p>
				{% endif %}
			</div>
		{% endif %}

		<!-- Indicateur de position -->
		<div class="absolute top-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded">
			{{ index + 1 }}
			/
			{{ total }}
		</div>
	</div>
{% endmacro %}

{# 
    Macro pour menus restaurant avec fallback √©l√©gant
#}
{% macro menu_image(menu, class="w-full h-auto rounded-lg shadow-md") %}
	{% if menu.mediaUrl %}
		{{ _self.image_optimized(menu.mediaUrl, 'Menu ' ~ menu.titre, class) }}
	{% elseif menu.semaine %}
		<!-- Fallback avec design pour menus texte -->
		<div class="bg-gradient-to-br from-orange-50 to-yellow-100 {{ class }} p-6 border-2 border-orange-200">
			<div class="text-center">
				<h3 class="text-xl font-bold text-orange-800 mb-4">üçΩÔ∏è
					{{ menu.titre }}</h3>
				{% if menu.lundi or menu.mardi or menu.mercredi or menu.jeudi or menu.vendredi %}
					<div class="space-y-2 text-sm text-orange-700">
						{% if menu.lundi %}
							<div>
								<strong>Lundi:</strong>
								{{ menu.lundi }}</div>
						{% endif %}
						{% if menu.mardi %}
							<div>
								<strong>Mardi:</strong>
								{{ menu.mardi }}</div>
						{% endif %}
						{% if menu.mercredi %}
							<div>
								<strong>Mercredi:</strong>
								{{ menu.mercredi }}</div>
						{% endif %}
						{% if menu.jeudi %}
							<div>
								<strong>Jeudi:</strong>
								{{ menu.jeudi }}</div>
						{% endif %}
						{% if menu.vendredi %}
							<div>
								<strong>Vendredi:</strong>
								{{ menu.vendredi }}</div>
						{% endif %}
					</div>
				{% endif %}
			</div>
		</div>
	{% else %}
		<!-- Placeholder menu vide -->
		<div class="bg-gray-100 {{ class }} flex items-center justify-center border-2 border-dashed border-gray-300">
			<div class="text-center text-gray-500">
				<svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
				</svg>
				<span class="text-sm">Menu en cours de pr√©paration</span>
			</div>
		</div>
	{% endif %}
{% endmacro %}

{# 
    Macro pour galerie avec lightbox et optimisations
#}
{% macro gallery_image(image, class="w-full h-64 object-cover cursor-pointer hover:scale-105 transition-transform") %}
	<div class="gallery-item relative group" data-lightbox="{{ image.id }}">
		{{ _self.image_optimized(image.url, image.alt, class) }}

		<!-- Overlay au survol -->
		<div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center">
			<svg class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewbox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
			</svg>
		</div>

		{% if image.titre %}
			<div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2">
				<span class="text-white text-sm font-medium">{{ image.titre }}</span>
			</div>
		{% endif %}
	</div>
{% endmacro %}

{# 
    Macro utilitaire pour v√©rifier si une image WebP existe
    (n√©cessite JavaScript c√¥t√© client pour v√©rification compl√®te)
#}
{% macro webp_support_check() %}
	<script>
		// V√©rification support WebP navigateur + images disponibles
(function () {
function supportsWebP(callback) {
const webP = new Image();
webP.onload = webP.onerror = function () {
callback(webP.height === 2);
};
webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
}

supportsWebP(function (supported) {
if (! supported) {
console.log('WebP non support√© - fallback images actif');
// Optionnel: ajouter classe CSS pour styling sp√©cifique
document.documentElement.classList.add('no-webp');
} else {
console.log('‚úÖ WebP support√© - images optimis√©es actives');
document.documentElement.classList.add('webp');
}
});
})();
	</script>
{% endmacro %}
