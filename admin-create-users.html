<!DOCTYPE html>
<html>

<head>
    <title>Cr√©er Utilisateurs</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }

        .button:hover {
            background: #0056b3;
        }

        .output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <h1>üîß Administration - Cr√©er Utilisateurs</h1>

    <p>Ce script va cr√©er/recr√©er les 4 utilisateurs principaux :</p>
    <ul>
        <li><strong>Lionel</strong> (l.camboulives@stmathieu.org) - DIRECTION</li>
        <li><strong>Frank</strong> (frank.quaracino@orange.fr) - GESTIONNAIRE_SITE</li>
        <li><strong>S√©bastien</strong> (sebcecg@gmail.com) - ADMIN</li>
        <li><strong>Yamina</strong> (yamina@ecolestmathieu.fr) - SECRETAIRE</li>
    </ul>

    <button class="button" onclick="createUsers()">üöÄ Cr√©er les utilisateurs</button>
    <button class="button" onclick="checkStatus()">üìã V√©rifier l'√©tat</button>

    <div id="output" class="output" style="display: none;"></div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.style.display = 'block';
            output.textContent += message + '\n';
        }

        async function createUsers() {
            const output = document.getElementById('output');
            output.textContent = 'üîÑ Cr√©ation des utilisateurs en cours...\n';
            output.style.display = 'block';

            try {
                const response = await fetch('/admin/create-users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action: 'create' })
                });

                if (response.ok) {
                    const result = await response.json();
                    log('‚úÖ ' + result.message);
                    if (result.users) {
                        result.users.forEach(user => {
                            log(`‚Ä¢ ${user.firstName} ${user.lastName} (${user.email}) - ${user.role}`);
                        });
                    }
                } else {
                    log('‚ùå Erreur HTTP: ' + response.status);
                }
            } catch (error) {
                log('‚ùå Erreur: ' + error.message);
                log('üí° Essayez d\'ex√©cuter directement: node create-main-users-updated.js');
            }
        }

        async function checkStatus() {
            const output = document.getElementById('output');
            output.textContent = 'üîç V√©rification de l\'√©tat...\n';
            output.style.display = 'block';

            try {
                const response = await fetch('/admin/check-users');
                if (response.ok) {
                    const result = await response.json();
                    log('üë• Utilisateurs existants:');
                    if (result.users && result.users.length > 0) {
                        result.users.forEach(user => {
                            log(`‚Ä¢ ${user.firstName} ${user.lastName} (${user.email}) - ${user.role}`);
                        });
                    } else {
                        log('Aucun utilisateur trouv√©.');
                    }
                } else {
                    log('‚ùå Erreur HTTP: ' + response.status);
                }
            } catch (error) {
                log('‚ùå Erreur: ' + error.message);
            }
        }

        // V√©rifier l'√©tat au chargement
        window.onload = function () {
            log('üîß Page d\'administration charg√©e.\n');
            log('üí° Instructions manuelles si les boutons ne fonctionnent pas:');
            log('1. Ouvrir un terminal/invite de commandes');
            log('2. Naviguer vers: c:\\Documents\\RI7\\Ecole St Mathieu Projet final');
            log('3. Ex√©cuter: node create-main-users-updated.js');
            log('4. Les utilisateurs seront cr√©√©s avec les mots de passe indiqu√©s ci-dessus');
        };
    </script>
</body>

</html>