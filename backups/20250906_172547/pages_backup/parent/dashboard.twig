{% extends "layouts/base.twig" %}

{% block main %}
	<div class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
		<div
			class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

			<!-- En-tête moderne -->
			<div class="mb-8">
				<div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8">
					<div class="text-center">
						<h1 class="text-4xl font-bold text-slate-800 mb-2">
							👨‍👩‍👧‍👦 Espace Parents
						</h1>
						<p class="text-xl text-slate-600">
							Bienvenue,
							<span class="font-semibold text-blue-600">{{ user.firstName }}
								{{ user.lastName }}</span>
						</p>
						<p class="text-sm text-slate-500 mt-1">Famille - École Saint-Mathieu</p>

						<!-- Affichage des enfants -->
						{% if enfants|length > 0 %}
							<div class="mt-6">
								<p class="text-lg font-medium text-slate-700 mb-4">
									{% if enfants|length == 1 %}
										Suivi de la scolarité de
									{% else %}
										Suivi de la scolarité de vos enfants
									{% endif %}
								</p>
								<div class="flex justify-center flex-wrap gap-3">
									{% for enfant in enfants %}
										<div class="bg-blue-50 border border-blue-200 px-4 py-2 inline-flex items-center">
											<span class="text-blue-800 font-semibold">
												👶
												{{ enfant.firstName }}
												{{ enfant.lastName }}
											</span>
											<span class="text-blue-600 text-sm ml-2">
												({{ enfant.classe.nom }})
											</span>
										</div>
									{% endfor %}
								</div>
							</div>
						{% else %}
							<div class="mt-6">
								<div class="bg-orange-50 border border-orange-200 p-4 max-w-md mx-auto">
									<p class="text-orange-800 font-medium">
										⚠️ Aucun enfant associé à votre compte
									</p>
								</div>
							</div>
						{% endif %}

						<!-- Messages non lus -->
						{% if messagesNonLus > 0 %}
							<div class="mt-6">
								<span class="inline-flex items-center px-4 py-2 bg-red-100 text-red-800 font-medium text-sm">
									🔔
									{{ messagesNonLus }}
									nouveau{{ messagesNonLus > 1 ? 'x' : '' }}
									message{{ messagesNonLus > 1 ? 's' : '' }}
								</span>
							</div>
						{% endif %}

						<div class="text-3xl mt-4">📚</div>
						<p class="text-sm text-slate-500">Tableau de bord</p>
					</div>
				</div>
			</div>

			<!-- Actions principales -->
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-slate-800 mb-6 text-center flex items-center justify-center">
					<span class="mr-3">⚡</span>
					Services Parents
				</h2>
				<div class="flex flex-wrap justify-center gap-6">

					<a href="/parent/messages" class="group bg-white shadow-md border-l-4 border-purple-500 p-6 hover:shadow-xl hover:border-purple-600 transition-all duration-300 text-center w-64 h-48">
						<div class="flex flex-col items-center h-full justify-center">
							<div class="bg-purple-100 p-3 group-hover:bg-purple-200 transition-colors mb-4">
								<svg class="h-8 w-8 text-purple-600" fill="none" viewbox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
								</svg>
							</div>
							<h3 class="text-lg font-bold text-slate-800 mb-2">Messagerie</h3>
							<p class="text-slate-600 text-sm">Communication école</p>
							{% if messagesNonLus > 0 %}
								<div class="mt-2">
									<span class="bg-red-100 text-red-800 px-2 py-1 text-xs font-medium">
										{{ messagesNonLus }}
										nouveau{{ messagesNonLus > 1 ? 'x' : '' }}
									</span>
								</div>
							{% endif %}
						</div>
					</a>

					<a href="/actualites" class="group bg-white shadow-md border-l-4 border-red-500 p-6 hover:shadow-xl hover:border-red-600 transition-all duration-300 text-center w-64 h-48">
						<div class="flex flex-col items-center h-full justify-center">
							<div class="bg-red-100 p-3 group-hover:bg-red-200 transition-colors mb-4">
								<svg class="h-8 w-8 text-red-600" fill="none" viewbox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
								</svg>
							</div>
							<h3 class="text-lg font-bold text-slate-800 mb-2">Actualités</h3>
							<p class="text-slate-600 text-sm">Informations école</p>
						</div>
					</a>
				</div>
			</div>

			<!-- Mes enfants - Accès rapide -->
			{% if enfants|length > 0 %}
				<div class="mb-8">
					<h2 class="text-2xl font-bold text-slate-800 mb-6 text-center flex items-center justify-center">
						<span class="mr-3">👶</span>
						Mes Enfants
					</h2>
					<div class="flex flex-wrap justify-center gap-6">
						{% for enfant in enfants %}
							<a href="/parent/suivi-scolaire/{{ enfant.id }}" class="group bg-white shadow-md border-l-4 border-blue-500 p-6 hover:shadow-xl hover:border-blue-600 transition-all duration-300 w-80 h-64">
								<div
									class="flex flex-col h-full">
									<!-- En-tête enfant -->
									<div class="flex items-center mb-4">
										<div class="bg-blue-100 p-3 group-hover:bg-blue-200 transition-colors mr-4">
											<svg class="h-8 w-8 text-blue-600" fill="none" viewbox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
											</svg>
										</div>
										<div>
											<h3 class="text-xl font-bold text-slate-800">{{ enfant.firstName }}
												{{ enfant.lastName }}</h3>
											<p class="text-sm text-slate-500">{{ enfant.classe.nom }}
												-
												{{ enfant.classe.niveau }}</p>
										</div>
									</div>

									<!-- Informations scolaires -->
									<div class="flex-grow space-y-3">
										{% if enfant.notes|length > 0 %}
											<div class="bg-slate-50 p-3 border border-slate-200">
												<h5 class="text-sm font-medium text-slate-700 mb-2">📝 Dernières notes</h5>
												<div class="space-y-1">
													{% for note in enfant.notes|slice(0, 2) %}
														<div class="flex justify-between text-sm">
															<span class="text-slate-600">{{ note.matiere }}</span>
															<span class="font-bold text-blue-600">{{ note.note }}/20</span>
														</div>
													{% endfor %}
												</div>
											</div>
										{% endif %}

										{% if enfant.absences|length > 0 %}
											<div class="bg-slate-50 p-3 border border-slate-200">
												<h5 class="text-sm font-medium text-slate-700 mb-2">📅 Absences récentes</h5>
												<div class="space-y-1">
													{% for absence in enfant.absences|slice(0, 1) %}
														<div class="text-sm">
															<span class="{% if absence.justifiee %}text-green-600{% else %}text-red-600{% endif %}">
																{{ absence.dateDebut|date('d/m/Y') }}
																-
																{{ absence.motif }}
															</span>
														</div>
													{% endfor %}
												</div>
											</div>
										{% endif %}
									</div>

									<!-- Action -->
									<div class="mt-4 pt-3 border-t border-slate-200">
										<div class="flex items-center justify-center text-blue-600 font-medium text-sm group-hover:text-blue-800">
											Voir le détail →
										</div>
									</div>
								</div>
							</a>
						{% endfor %}
					</div>
				</div>
			{% endif %}

			<!-- Actualités récentes -->
			{% if actualites|length > 0 %}
				<div class="mb-8">
					<h2 class="text-2xl font-bold text-slate-800 mb-6 text-center flex items-center justify-center">
						<span class="mr-3">📢</span>
						Actualités de l'École
					</h2>
					<div class="flex flex-wrap justify-center gap-6">
						{% for actualite in actualites %}
							<div class="bg-white shadow-md border-l-4 border-red-500 p-6 hover:shadow-xl transition-all duration-300 w-80 h-64">
								<div
									class="flex flex-col h-full">
									<!-- En-tête actualité -->
									<div class="flex items-start justify-between mb-4">
										<div class="flex items-start">
											<div class="bg-red-100 p-2 mr-3">
												<svg class="h-6 w-6 text-red-600" fill="none" viewbox="0 0 24 24" stroke="currentColor">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
												</svg>
											</div>
											<div class="flex-1">
												<h3 class="text-lg font-bold text-slate-800 mb-1">
													{% if actualite.important %}
														<span class="inline-flex items-center px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 mr-2">
															Important
														</span>
													{% endif %}
													{{ actualite.titre }}
												</h3>
											</div>
										</div>
									</div>

									<!-- Contenu -->
									<div class="flex-grow mb-4">
										<p class="text-slate-600 text-sm line-clamp-4">
											{{ actualite.contenu|slice(0, 120) }}
											{% if actualite.contenu|length > 120 %}...
											{% endif %}
										</p>
									</div>

									<!-- Pied de page -->
									<div class="border-t border-slate-200 pt-3 mt-auto">
										<div class="flex items-center justify-between text-xs text-slate-500">
											<span>{{ actualite.auteur.firstName }}
												{{ actualite.auteur.lastName }}</span>
											<span>{{ actualite.datePublication|date('d/m/Y') }}</span>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
					<div class="text-center mt-6">
						<a href="/actualites" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 font-medium transition-colors">
							Voir toutes les actualités
						</a>
					</div>
				</div>
			{% endif %}
		</div>
	</div>
{% endblock %}
