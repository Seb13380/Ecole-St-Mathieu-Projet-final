<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; frame-src 'self' https://www.google.com https://maps.google.com https://www.openstreetmap.org; img-src 'self' data: https: *.googleapis.com *.gstatic.com *.openstreetmap.org;">
    <title>Test Google Maps - √âcole Saint-Mathieu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .map-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #45a049;
        }

        .error {
            color: red;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .success {
            color: green;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>üó∫Ô∏è Test Google Maps - √âcole Saint-Mathieu</h1>

    <div class="test-section">
        <h2>1. Google Maps Embed (m√©thode actuelle)</h2>
        <div class="map-container">
            <iframe id="google-maps-1"
                src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d11611.506!2d5.427776!3d43.340679!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2z4oCOMjIgUGxhY2UgZGVzIEjDqXJvcywgMTMwMTMgTWFyc2VpbGxl!5e0!3m2!1sfr!2sfr!4v1693906800000!5m2!1sfr!2sfr"
                width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"
                referrerpolicy="no-referrer-when-downgrade" title="√âcole Saint-Mathieu">
            </iframe>
        </div>
        <button onclick="testGoogleMaps1()">Tester cette carte</button>
        <div id="result-1"></div>
    </div>

    <div class="test-section">
        <h2>2. Google Maps Embed (URL alternative)</h2>
        <div class="map-container">
            <iframe id="google-maps-2"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2902.8764545678!2d5.427776056789!3d43.340678901234!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12c9c6c0a1b2c3d4%3A0x123456789abcdef0!2s22%20Place%20des%20H%C3%A9ros%2C%2013013%20Marseille%2C%20France!5e0!3m2!1sfr!2sfr!4v1693906800000!5m2!1sfr!2sfr"
                width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"
                title="√âcole Saint-Mathieu Alt">
            </iframe>
        </div>
        <button onclick="testGoogleMaps2()">Tester cette carte</button>
        <div id="result-2"></div>
    </div>

    <div class="test-section">
        <h2>3. OpenStreetMap (Fallback)</h2>
        <div class="map-container">
            <iframe id="osm-maps"
                src="https://www.openstreetmap.org/export/embed.html?bbox=5.4247776%2C43.3356789%2C5.4347776%2C43.3456789&layer=mapnik&marker=43.340679%2C5.427776"
                width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"
                title="√âcole Saint-Mathieu OSM">
            </iframe>
        </div>
        <button onclick="testOSM()">Tester OpenStreetMap</button>
        <div id="result-3"></div>
    </div>

    <div class="test-section">
        <h2>4. Lien direct Google Maps</h2>
        <p>
            <a href="https://maps.google.com/maps?q=22+Place+des+H√©ros,+13013+Marseille,+France" target="_blank">
                üó∫Ô∏è Ouvrir dans Google Maps (nouvelle fen√™tre)
            </a>
        </p>
    </div>

    <div class="test-section">
        <h2>üîß Diagnostic</h2>
        <button onclick="runFullDiagnostic()">Lancer diagnostic complet</button>
        <div id="diagnostic-results"></div>
    </div>

    <script>
        function testGoogleMaps1() {
            const iframe = document.getElementById('google-maps-1');
            const result = document.getElementById('result-1');

            result.innerHTML = '<div>‚è≥ Test en cours...</div>';

            setTimeout(() => {
                try {
                    if (iframe.contentWindow) {
                        result.innerHTML = '<div class="success">‚úÖ Google Maps 1 semble accessible</div>';
                    } else {
                        result.innerHTML = '<div class="error">‚ùå Google Maps 1 bloqu√©</div>';
                    }
                } catch (e) {
                    result.innerHTML = '<div class="error">‚ùå Erreur Google Maps 1: ' + e.message + '</div>';
                }
            }, 3000);
        }

        function testGoogleMaps2() {
            const iframe = document.getElementById('google-maps-2');
            const result = document.getElementById('result-2');

            result.innerHTML = '<div>‚è≥ Test en cours...</div>';

            setTimeout(() => {
                try {
                    if (iframe.contentWindow) {
                        result.innerHTML = '<div class="success">‚úÖ Google Maps 2 semble accessible</div>';
                    } else {
                        result.innerHTML = '<div class="error">‚ùå Google Maps 2 bloqu√©</div>';
                    }
                } catch (e) {
                    result.innerHTML = '<div class="error">‚ùå Erreur Google Maps 2: ' + e.message + '</div>';
                }
            }, 3000);
        }

        function testOSM() {
            const iframe = document.getElementById('osm-maps');
            const result = document.getElementById('result-3');

            result.innerHTML = '<div>‚è≥ Test en cours...</div>';

            setTimeout(() => {
                try {
                    if (iframe.contentWindow) {
                        result.innerHTML = '<div class="success">‚úÖ OpenStreetMap accessible</div>';
                    } else {
                        result.innerHTML = '<div class="error">‚ùå OpenStreetMap bloqu√©</div>';
                    }
                } catch (e) {
                    result.innerHTML = '<div class="error">‚ùå Erreur OpenStreetMap: ' + e.message + '</div>';
                }
            }, 3000);
        }

        function runFullDiagnostic() {
            const diagnosticDiv = document.getElementById('diagnostic-results');
            let results = '<h3>üìä R√©sultats du diagnostic :</h3>';

            // Test du protocole
            results += '<p><strong>Protocole actuel :</strong> ' + window.location.protocol + '</p>';

            // Test HTTPS
            if (window.location.protocol === 'https:') {
                results += '<p class="success">‚úÖ Site en HTTPS - Compatible Google Maps</p>';
            } else {
                results += '<p class="error">‚ö†Ô∏è Site en HTTP - Possible conflit avec Google Maps HTTPS</p>';
            }

            // Test Content Security Policy
            const metaCSP = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (metaCSP) {
                results += '<p class="success">‚úÖ Content Security Policy configur√©</p>';
                results += '<p><small>CSP: ' + metaCSP.getAttribute('content') + '</small></p>';
            } else {
                results += '<p class="error">‚ö†Ô∏è Pas de Content Security Policy d√©tect√©</p>';
            }

            // Test navigateur
            results += '<p><strong>Navigateur :</strong> ' + navigator.userAgent + '</p>';

            // Test des iframes
            const iframes = document.querySelectorAll('iframe');
            results += '<p><strong>Nombre d\'iframes :</strong> ' + iframes.length + '</p>';

            diagnosticDiv.innerHTML = results;

            // Test automatique de toutes les cartes
            setTimeout(() => {
                testGoogleMaps1();
                testGoogleMaps2();
                testOSM();
            }, 1000);
        }

        // Auto-test au chargement
        window.addEventListener('load', function () {
            console.log('üöÄ Page de test Google Maps charg√©e');
            console.log('Protocole:', window.location.protocol);
            console.log('Host:', window.location.host);
        });
    </script>
</body>

</html>